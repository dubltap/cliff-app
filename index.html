<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLIFF NOTEZ - Doctorate-Level Research & Analysis</title>
  <meta name="description" content="Evidence-first research assistant. Multi-source verification, claim-level confidence ratings, and traceable citations. From mystery to mastery.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
:root {
  --cliff-gold: #C9A227;
  --cliff-amber: #D4A574;
  --cliff-light: #F5E6C8;
  --ocean-deep: #264653;
  --ocean-teal: #2A9D8F;
  --ocean-foam: #A8DADC;
  --sand-light: #FDF8F3;
  --sand-warm: #E9E0D6;
  --sand-dark: #4A4238;
  --sunset-coral: #E76F51;
  --sunset-gold: #F4A261;
  --ecr-5: #2A9D8F;
  --ecr-4: #52B788;
  --ecr-3: #F4A261;
  --ecr-2: #E76F51;
  --ecr-1: #9D4EDD;
  --space-xs: 0.382rem;
  --space-sm: 0.618rem;
  --space-md: 1rem;
  --space-lg: 1.618rem;
  --space-xl: 2.618rem;
  --font-display: 'Outfit', system-ui, sans-serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: var(--font-body);
  background: linear-gradient(135deg, var(--sand-light) 0%, #F0E8DC 100%);
  color: var(--sand-dark);
  min-height: 100vh;
  line-height: 1.6;
}

/* Header */
.header {
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--ocean-foam);
  padding: var(--space-md) var(--space-lg);
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-md);
}
.logo-section {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}
.logo {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 1.3rem;
  color: white;
  box-shadow: 0 2px 8px rgba(201,162,39,0.3);
}
.brand h1 {
  font-family: var(--font-display);
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--ocean-deep);
}
.brand span {
  font-size: 0.75rem;
  color: var(--cliff-amber);
  display: block;
}
.header-actions {
  display: flex;
  gap: var(--space-sm);
  align-items: center;
}
.usage-badge {
  background: var(--cliff-light);
  color: var(--cliff-gold);
  padding: var(--space-xs) var(--space-sm);
  border-radius: 100px;
  font-size: 0.8rem;
  font-weight: 600;
}
.btn {
  font-family: var(--font-body);
  font-weight: 600;
  padding: var(--space-sm) var(--space-lg);
  border-radius: 100px;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.9rem;
}
.btn-primary {
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  color: white;
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(201,162,39,0.3); }
.btn-secondary {
  background: transparent;
  color: var(--ocean-deep);
  border: 1px solid var(--ocean-foam);
}

/* Hero */
.hero {
  text-align: center;
  padding: var(--space-xl) var(--space-lg);
  max-width: 800px;
  margin: 0 auto;
}
.hero h2 {
  font-family: var(--font-display);
  font-size: clamp(1.8rem, 4vw, 2.5rem);
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.hero h2 span {
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.hero p {
  color: var(--sand-dark);
  font-size: 1.05rem;
}

/* Main Container */
.app-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--space-lg) var(--space-xl);
  display: grid;
  grid-template-columns: 380px 1fr;
  gap: var(--space-lg);
}
@media (max-width: 1000px) {
  .app-container { grid-template-columns: 1fr; }
  .input-panel { position: static !important; }
}

/* Input Panel */
.input-panel {
  background: white;
  border-radius: 16px;
  padding: var(--space-lg);
  box-shadow: 0 4px 20px rgba(0,0,0,0.06);
  border: 1px solid var(--ocean-foam);
  height: fit-content;
  position: sticky;
  top: 90px;
}
.panel-title {
  font-family: var(--font-display);
  font-size: 1rem;
  font-weight: 600;
  color: var(--ocean-deep);
  margin-bottom: var(--space-md);
}

/* Mode Selector */
.mode-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-xs);
  margin-bottom: var(--space-lg);
}
.mode-btn {
  padding: var(--space-sm);
  border: 1px solid var(--ocean-foam);
  border-radius: 8px;
  background: white;
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--sand-dark);
  font-family: var(--font-body);
  transition: all 0.2s;
}
.mode-btn:hover { border-color: var(--cliff-gold); }
.mode-btn.active {
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  color: white;
  border-color: transparent;
}

/* Input Area */
.input-section { margin-bottom: var(--space-md); }
.input-section label {
  display: block;
  font-size: 0.85rem;
  font-weight: 500;
  margin-bottom: var(--space-xs);
  color: var(--ocean-deep);
}
.input-section textarea {
  width: 100%;
  min-height: 160px;
  padding: var(--space-md);
  border: 1px solid var(--ocean-foam);
  border-radius: 10px;
  font-family: var(--font-body);
  font-size: 0.95rem;
  resize: vertical;
  transition: border-color 0.2s;
}
.input-section textarea:focus {
  outline: none;
  border-color: var(--cliff-gold);
}
.input-section textarea::placeholder { color: var(--sand-medium, #C4B7A6); }

/* Toggle */
.toggle-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-sm) 0;
  border-top: 1px solid var(--sand-warm);
  margin-bottom: var(--space-md);
}
.toggle-label { font-size: 0.85rem; }
.toggle-sublabel { font-size: 0.75rem; color: var(--sand-dark); opacity: 0.7; }
.toggle {
  width: 44px;
  height: 24px;
  background: var(--sand-warm);
  border-radius: 100px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s;
}
.toggle.active { background: var(--ocean-teal); }
.toggle::after {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  background: white;
  border-radius: 50%;
  top: 3px;
  left: 3px;
  transition: transform 0.2s;
}
.toggle.active::after { transform: translateX(20px); }

/* Analyze Button */
.analyze-btn {
  width: 100%;
  padding: var(--space-md);
  font-size: 1rem;
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-family: var(--font-body);
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
}
.analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(201,162,39,0.3); }
.analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

/* Output Panel */
.output-panel {
  background: white;
  border-radius: 16px;
  padding: var(--space-lg);
  box-shadow: 0 4px 20px rgba(0,0,0,0.06);
  border: 1px solid var(--ocean-foam);
  min-height: 500px;
}

/* Freshness Banner */
.freshness-banner {
  display: none;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  background: rgba(42,157,143,0.1);
  border-radius: 8px;
  margin-bottom: var(--space-md);
  font-size: 0.85rem;
}
.freshness-banner.show { display: flex; }
.freshness-icon { font-size: 1.2rem; }
.freshness-text { flex: 1; color: var(--ocean-deep); }
.freshness-badge {
  background: var(--ocean-teal);
  color: white;
  padding: 2px 8px;
  border-radius: 100px;
  font-size: 0.75rem;
  font-weight: 600;
}

/* View Toggle */
.view-toggle {
  display: none;
  gap: var(--space-xs);
  margin-bottom: var(--space-md);
  padding: var(--space-xs);
  background: var(--sand-light);
  border-radius: 8px;
  width: fit-content;
}
.view-toggle.show { display: flex; }
.view-btn {
  padding: var(--space-xs) var(--space-md);
  border: none;
  background: transparent;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
  font-family: var(--font-body);
  color: var(--sand-dark);
  transition: all 0.2s;
}
.view-btn.active { background: white; color: var(--ocean-deep); font-weight: 600; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* Pipeline Badge */
.pipeline-badge {
  display: inline-block;
  padding: var(--space-xs) var(--space-sm);
  background: rgba(42,157,143,0.1);
  color: var(--ocean-teal);
  border-radius: 6px;
  font-size: 0.8rem;
  margin-bottom: var(--space-md);
}

/* Results */
.result-title {
  font-family: var(--font-display);
  font-size: 1.4rem;
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.result-summary {
  background: var(--cliff-light);
  padding: var(--space-md);
  border-radius: 10px;
  margin-bottom: var(--space-lg);
  border-left: 4px solid var(--cliff-gold);
}

/* Finding Cards */
.finding-card {
  background: var(--sand-light);
  border: 1px solid var(--ocean-foam);
  border-radius: 10px;
  padding: var(--space-md);
  margin-bottom: var(--space-sm);
}
.finding-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--space-sm);
  margin-bottom: var(--space-xs);
}
.finding-text { flex: 1; font-size: 0.95rem; }
.ecr-chip {
  padding: 2px 8px;
  border-radius: 100px;
  font-size: 0.75rem;
  font-weight: 600;
  color: white;
  white-space: nowrap;
}
.ecr-5 { background: var(--ecr-5); }
.ecr-4 { background: var(--ecr-4); }
.ecr-3 { background: var(--ecr-3); }
.ecr-2 { background: var(--ecr-2); }
.ecr-1 { background: var(--ecr-1); }
.finding-meta {
  display: flex;
  gap: var(--space-sm);
  font-size: 0.75rem;
  color: var(--sand-dark);
  opacity: 0.8;
}
.bucket-badge {
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 500;
}
.bucket-common { background: rgba(42,157,143,0.15); color: var(--ocean-teal); }
.bucket-disputed { background: rgba(231,111,81,0.15); color: var(--sunset-coral); }

/* Quote Card */
.quote-card {
  background: white;
  border-left: 3px solid var(--cliff-gold);
  padding: var(--space-md);
  margin: var(--space-md) 0;
  border-radius: 0 8px 8px 0;
}
.quote-text {
  font-style: italic;
  color: var(--ocean-deep);
  margin-bottom: var(--space-xs);
}
.quote-source {
  font-size: 0.8rem;
  color: var(--sand-dark);
}

/* Disputed Section */
.disputed-section {
  background: rgba(231,111,81,0.05);
  border: 1px solid rgba(231,111,81,0.2);
  border-radius: 10px;
  padding: var(--space-md);
  margin: var(--space-md) 0;
}
.disputed-title {
  font-weight: 600;
  color: var(--sunset-coral);
  margin-bottom: var(--space-sm);
  font-size: 0.9rem;
}
.position-card {
  background: white;
  padding: var(--space-sm);
  border-radius: 6px;
  margin-bottom: var(--space-xs);
  font-size: 0.85rem;
}
.position-view { font-weight: 500; color: var(--ocean-deep); }
.position-support { font-size: 0.8rem; color: var(--sand-dark); }

/* Limitations */
.limitations-section {
  background: var(--sand-light);
  border-radius: 8px;
  padding: var(--space-md);
  margin-top: var(--space-lg);
}
.limitations-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.limitations-list {
  font-size: 0.85rem;
  color: var(--sand-dark);
  margin-left: var(--space-md);
}
.limitations-list li { margin-bottom: var(--space-xs); }

/* Recommendations */
.recommendations-section {
  margin-top: var(--space-lg);
}
.recommendations-title {
  font-family: var(--font-display);
  font-size: 1rem;
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.recommendation-item {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
  padding: var(--space-sm);
  background: rgba(42,157,143,0.05);
  border-radius: 6px;
  margin-bottom: var(--space-xs);
  font-size: 0.9rem;
}
.recommendation-icon { color: var(--ocean-teal); }

/* Placeholder */
.placeholder {
  text-align: center;
  padding: var(--space-xl) var(--space-lg);
  color: var(--sand-dark);
}
.placeholder-icon { font-size: 4rem; margin-bottom: var(--space-md); opacity: 0.5; }
.placeholder h3 {
  font-family: var(--font-display);
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.placeholder p { max-width: 400px; margin: 0 auto; }

/* Modals */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(38,70,83,0.6);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal {
  background: white;
  border-radius: 16px;
  padding: var(--space-xl);
  max-width: 440px;
  width: 90%;
  position: relative;
}
.modal-close {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--sand-dark);
  opacity: 0.5;
}
.modal-close:hover { opacity: 1; }
.modal-icon {
  width: 64px;
  height: 64px;
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  margin: 0 auto var(--space-md);
}
.modal h2 {
  font-family: var(--font-display);
  text-align: center;
  color: var(--ocean-deep);
  margin-bottom: var(--space-xs);
}
.modal > p {
  text-align: center;
  margin-bottom: var(--space-lg);
  color: var(--sand-dark);
}
.modal input[type="email"] {
  width: 100%;
  padding: var(--space-md);
  border: 1px solid var(--ocean-foam);
  border-radius: 10px;
  font-size: 1rem;
  font-family: var(--font-body);
  margin-bottom: var(--space-md);
}
.modal input:focus { outline: none; border-color: var(--cliff-gold); }
.modal-btn {
  width: 100%;
  padding: var(--space-md);
  background: linear-gradient(135deg, var(--cliff-gold), var(--cliff-amber));
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  font-family: var(--font-body);
}
.modal-btn:hover { transform: translateY(-1px); }
.modal-terms {
  text-align: center;
  font-size: 0.75rem;
  color: var(--sand-dark);
  opacity: 0.7;
  margin-top: var(--space-md);
}

/* Pricing */
.pricing-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}
.pricing-option {
  border: 2px solid var(--ocean-foam);
  border-radius: 10px;
  padding: var(--space-md);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  transition: all 0.2s;
}
.pricing-option:hover { border-color: var(--cliff-gold); }
.pricing-option.selected { border-color: var(--cliff-gold); background: var(--cliff-light); }
.popular-tag {
  position: absolute;
  top: -10px;
  right: 12px;
  background: var(--sunset-coral);
  color: white;
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 100px;
  font-weight: 600;
}
.pricing-name { font-weight: 600; color: var(--ocean-deep); }
.pricing-detail { font-size: 0.8rem; color: var(--sand-dark); }
.pricing-price strong { font-size: 1.3rem; color: var(--ocean-deep); }
.pricing-price span { font-size: 0.85rem; color: var(--sand-dark); }

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--ocean-deep);
  color: white;
  padding: var(--space-md) var(--space-lg);
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 1001;
  font-size: 0.9rem;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: var(--ocean-teal); }
.toast.error { background: var(--sunset-coral); }

/* Loading */
.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Footer */
.footer {
  text-align: center;
  padding: var(--space-xl);
  color: var(--sand-dark);
  font-size: 0.85rem;
}
.footer a { color: var(--ocean-teal); text-decoration: none; }
  </style>
</head>
<body>

<header class="header">
  <div class="header-content">
    <div class="logo-section">
      <div class="logo">CN</div>
      <div class="brand">
        <h1>CLIFF NOTEZ</h1>
        <span>Evidence-first research & analysis</span>
      </div>
    </div>
    <div class="header-actions">
      <span class="usage-badge" id="usageBadge">3 free analyses left</span>
      <button class="btn btn-primary" onclick="showUpgrade()">Upgrade Pro</button>
    </div>
  </div>
</header>

<section class="hero">
  <h2>Turn Any Text Into <span>Verified Insight</span></h2>
  <p>Decode any document. Research any topic. Get clarity on command with doctorate-level analysis and traceable evidence.</p>
</section>

<main class="app-container">
  <aside class="input-panel">
    <div class="panel-title">Analysis Mode</div>
    <div class="mode-grid">
      <button class="mode-btn active" data-mode="DoctoralReport">Doctoral Report</button>
      <button class="mode-btn" data-mode="CliffNotes">Cliff Notes</button>
      <button class="mode-btn" data-mode="Exegesis">Exegesis</button>
      <button class="mode-btn" data-mode="TutorMode">Tutor Mode</button>
      <button class="mode-btn" data-mode="CriticMode">Critic Mode</button>
      <button class="mode-btn" data-mode="LearningTrack">Learning Track</button>
    </div>

    <div class="input-section">
      <label>Research question or document text</label>
      <textarea id="promptInput" placeholder="Ask anything: 'What is the book of Thoth?' or 'Explain quantum entanglement' or paste document text to analyze..."></textarea>
    </div>

    <div class="toggle-row">
      <div>
        <div class="toggle-label">Freshness verification</div>
        <div class="toggle-sublabel">Show verification timestamp</div>
      </div>
      <div class="toggle active" id="freshnessToggle" onclick="this.classList.toggle('active')"></div>
    </div>

    <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
      <span>Analyze</span>
      <span>‚Üí</span>
    </button>
  </aside>

  <section class="output-panel">
    <div class="freshness-banner" id="freshnessBanner">
      <span class="freshness-icon">üîÑ</span>
      <span class="freshness-text" id="freshnessText">Verified as of: --</span>
      <span class="freshness-badge">‚úì Verified</span>
    </div>

    <div class="view-toggle" id="viewToggle">
      <button class="view-btn active" data-view="all">All</button>
      <button class="view-btn" data-view="common">Common Ground</button>
      <button class="view-btn" data-view="disputed">Disputed</button>
    </div>

    <div id="outputContent">
      <div class="placeholder">
        <div class="placeholder-icon">üìö</div>
        <h3>Ready to Research</h3>
        <p>Ask any question or paste document text. CLIFF will provide doctorate-level analysis with traceable evidence and confidence ratings.</p>
      </div>
    </div>
  </section>
</main>

<!-- Email Modal -->
<div class="modal-overlay" id="emailModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('emailModal')">√ó</button>
    <div class="modal-icon">üìö</div>
    <h2>Unlock CLIFF NOTEZ</h2>
    <p>Get 3 free doctorate-level analyses with evidence verification.</p>
    <input type="email" id="emailInput" placeholder="your@email.com">
    <button class="modal-btn" onclick="submitEmail()">Get Free Access</button>
    <p class="modal-terms">By continuing, you agree to our <a href="https://dubltap.io/terms" target="_blank" style="color: inherit;">Terms</a> & <a href="https://dubltap.io/privacy" target="_blank" style="color: inherit;">Privacy Policy</a>. No spam.</p>
  </div>
</div>

<!-- Upgrade Modal -->
<div class="modal-overlay" id="upgradeModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('upgradeModal')">√ó</button>
    <div class="modal-icon">üéì</div>
    <h2>Upgrade to Pro</h2>
    <p>Unlimited analyses, all modes, priority processing.</p>
    <div class="pricing-options">
      <div class="pricing-option selected" data-plan="annual" onclick="selectPlan(this)">
        <span class="popular-tag">Best Value</span>
        <div>
          <div class="pricing-name">Annual</div>
          <div class="pricing-detail">Save 35%</div>
        </div>
        <div class="pricing-price">
          <strong>$149</strong>
          <span>/year</span>
        </div>
      </div>
      <div class="pricing-option" data-plan="monthly" onclick="selectPlan(this)">
        <div>
          <div class="pricing-name">Monthly</div>
          <div class="pricing-detail">Cancel anytime</div>
        </div>
        <div class="pricing-price">
          <strong>$19</strong>
          <span>/mo</span>
        </div>
      </div>
    </div>
    <button class="modal-btn" onclick="subscribePro()">Start Pro Access</button>
    <p class="modal-terms">30-day money-back guarantee</p>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span id="toastIcon">‚úì</span>
  <span id="toastText">Success!</span>
</div>

<footer class="footer">
  <div style="margin-bottom: 0.5rem;">
    <a href="https://dubltap.io/privacy" target="_blank" rel="noopener" style="color: inherit; opacity: 0.7; margin: 0 0.5rem;">Privacy Policy</a>
    <span style="opacity: 0.3;">|</span>
    <a href="https://dubltap.io/terms" target="_blank" rel="noopener" style="color: inherit; opacity: 0.7; margin: 0 0.5rem;">Terms of Service</a>
  </div>
  <small style="opacity: 0.5;">¬© 2026 dubltap.io LLC - ALL RIGHTS RESERVED - dubltap F1</small>
</footer>

<script>
const API_BASE = 'https://api.dubltap.io';
const STRIPE_PRICES = {
  monthly: 'price_1SviddBkYqg7J4R7wwwCGKId',
  annual: 'price_1SviefBkYqg7J4R7y6KW4pXQ'
};
const FREE_LIMIT = 3;

const state = {
  email: localStorage.getItem('cliff_email') || null,
  usageCount: parseInt(localStorage.getItem('cliff_usage') || '0'),
  mode: 'DoctoralReport',
  selectedPlan: 'annual',
  currentView: 'all',
  lastResult: null
};

// Init
document.addEventListener('DOMContentLoaded', function() {
  updateUsageBadge();
  initModeButtons();
  initViewButtons();
  
  var params = new URLSearchParams(window.location.search);
  if (params.get('upgraded') === 'true') {
    showToast('Welcome to Pro! Unlimited analyses unlocked.', 'success');
    localStorage.setItem('cliff_pro', 'true');
    window.history.replaceState({}, '', window.location.pathname);
  }
  
  if (!state.email) {
    setTimeout(function() { showModal('emailModal'); }, 2000);
  }
});

function initModeButtons() {
  document.querySelectorAll('.mode-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.mode-btn').forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active');
      state.mode = btn.dataset.mode;
    });
  });
}

function initViewButtons() {
  document.querySelectorAll('.view-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.view-btn').forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active');
      state.currentView = btn.dataset.view;
      filterFindings();
    });
  });
}

async function runAnalysis() {
  var content = document.getElementById('promptInput').value.trim();
  
  if (!content) {
    showToast('Please enter a question or text to analyze', 'error');
    return;
  }
  
  if (!state.email) {
    showModal('emailModal');
    return;
  }
  
  var isPro = localStorage.getItem('cliff_pro') === 'true';
  if (!isPro && state.usageCount >= FREE_LIMIT) {
    showUpgrade();
    return;
  }

  var btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="loading-spinner"></span> Analyzing...';

  // Determine action: longer content = document analysis, shorter = research query
  var action = content.length > 500 ? 'analyze-document' : 'research';

  try {
    var response = await fetch(API_BASE + '/api/ai-query', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        app: 'cliff-notez',
        action: action,
        content: content,
        mode: state.mode,
        email: state.email
      })
    });
    
    var data = await response.json();
    
    if (data.error) {
      showToast(data.error, 'error');
      return;
    }
    
    if (!isPro) {
      state.usageCount++;
      localStorage.setItem('cliff_usage', state.usageCount.toString());
      updateUsageBadge();
    }
    
    // Parse result
    var result;
    try {
      result = typeof data.result === 'string' ? JSON.parse(data.result) : data.result;
    } catch(e) {
      result = { summary: data.result, keyFindings: [], disputed: [], limitations: [], recommendations: [] };
    }
    
    state.lastResult = result;
    renderResults(result);
    
  } catch (error) {
    console.error('Analysis error:', error);
    showToast('Analysis failed - please try again', 'error');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<span>Analyze</span><span>‚Üí</span>';
  }
}

function renderResults(data) {
  var output = document.getElementById('outputContent');
  var freshness = document.getElementById('freshnessBanner');
  var viewToggle = document.getElementById('viewToggle');
  
  // Show freshness
  if (document.getElementById('freshnessToggle').classList.contains('active')) {
    freshness.classList.add('show');
    document.getElementById('freshnessText').textContent = 'Verified as of: ' + (data.asOf || new Date().toISOString());
  } else {
    freshness.classList.remove('show');
  }
  
  // Show view toggle if there are disputed items
  if (data.disputed && data.disputed.length > 0) {
    viewToggle.classList.add('show');
  } else {
    viewToggle.classList.remove('show');
  }
  
  var html = '';
  
  // Title
  if (data.title) {
    html += '<h2 class="result-title">' + esc(data.title) + '</h2>';
  }
  
  // Pipeline badge
  html += '<div class="pipeline-badge">Mode: ' + esc(data.mode || state.mode) + ' | Pipelines: AI Analysis, Evidence Synthesis</div>';
  
  // Summary
  if (data.summary) {
    html += '<div class="result-summary">' + esc(data.summary) + '</div>';
  }
  
  // Key Findings
  if (data.keyFindings && data.keyFindings.length > 0) {
    html += '<h3 style="font-family:var(--font-display);color:var(--ocean-deep);margin-bottom:var(--space-md);">Key Findings</h3>';
    html += '<div id="findingsContainer">';
    data.keyFindings.forEach(function(f) {
      var conf = f.confidence || 4;
      var label = f.confidenceLabel || getConfLabel(conf);
      var bucket = f.bucket || 'common';
      html += '<div class="finding-card" data-bucket="' + bucket + '">';
      html += '<div class="finding-header">';
      html += '<div class="finding-text">' + esc(f.finding) + '</div>';
      html += '<span class="ecr-chip ecr-' + conf + '">' + conf + '/5 ' + esc(label) + '</span>';
      html += '</div>';
      html += '<div class="finding-meta">';
      html += '<span class="bucket-badge bucket-' + bucket + '">' + (bucket === 'common' ? 'Common Ground' : 'Disputed') + '</span>';
      if (f.sourceType) html += '<span>' + esc(f.sourceType) + '</span>';
      html += '</div>';
      html += '</div>';
    });
    html += '</div>';
  }
  
  // Disputed Section
  if (data.disputed && data.disputed.length > 0) {
    html += '<div class="disputed-section" id="disputedSection">';
    html += '<div class="disputed-title">‚ö†Ô∏è Areas of Disagreement</div>';
    data.disputed.forEach(function(d) {
      html += '<div style="margin-bottom:var(--space-md);">';
      html += '<div style="font-weight:500;margin-bottom:var(--space-xs);">' + esc(d.topic) + '</div>';
      if (d.positions) {
        d.positions.forEach(function(p) {
          html += '<div class="position-card">';
          html += '<div class="position-view">' + esc(p.view) + '</div>';
          html += '<div class="position-support">Supported by: ' + esc(p.support) + '</div>';
          html += '</div>';
        });
      }
      html += '</div>';
    });
    html += '</div>';
  }
  
  // Quotes
  if (data.quotes && data.quotes.length > 0) {
    html += '<h3 style="font-family:var(--font-display);color:var(--ocean-deep);margin:var(--space-lg) 0 var(--space-md);">Key Quotes</h3>';
    data.quotes.forEach(function(q) {
      html += '<div class="quote-card">';
      html += '<div class="quote-text">"' + esc(q.text) + '"</div>';
      html += '<div class="quote-source">‚Äî ' + esc(q.source);
      if (q.locator) html += ' (' + esc(q.locator) + ')';
      html += '</div>';
      html += '</div>';
    });
  }
  
  // Recommendations
  if (data.recommendations && data.recommendations.length > 0) {
    html += '<div class="recommendations-section">';
    html += '<h3 class="recommendations-title">Recommendations</h3>';
    data.recommendations.forEach(function(r) {
      html += '<div class="recommendation-item">';
      html += '<span class="recommendation-icon">‚Üí</span>';
      html += '<span>' + esc(r) + '</span>';
      html += '</div>';
    });
    html += '</div>';
  }
  
  // Related Topics
  if (data.relatedTopics && data.relatedTopics.length > 0) {
    html += '<div style="margin-top:var(--space-lg);"><strong>Related Topics:</strong> ';
    html += data.relatedTopics.map(function(t) { return esc(t); }).join(', ');
    html += '</div>';
  }
  
  // Limitations
  if (data.limitations && data.limitations.length > 0) {
    html += '<div class="limitations-section">';
    html += '<div class="limitations-title">‚ö†Ô∏è Limitations & Caveats</div>';
    html += '<ul class="limitations-list">';
    data.limitations.forEach(function(l) {
      html += '<li>' + esc(l) + '</li>';
    });
    html += '</ul>';
    html += '</div>';
  }
  
  output.innerHTML = html;
}

function filterFindings() {
  var cards = document.querySelectorAll('.finding-card');
  var disputed = document.getElementById('disputedSection');
  
  cards.forEach(function(card) {
    var bucket = card.dataset.bucket;
    if (state.currentView === 'all') {
      card.style.display = '';
    } else if (state.currentView === 'common' && bucket === 'common') {
      card.style.display = '';
    } else if (state.currentView === 'disputed' && bucket === 'disputed') {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
  
  if (disputed) {
    disputed.style.display = (state.currentView === 'common') ? 'none' : '';
  }
}

function getConfLabel(n) {
  var labels = { 5: 'Strong Consensus', 4: 'Consensus', 3: 'Majority View', 2: 'Contested', 1: 'Speculative' };
  return labels[n] || 'Unknown';
}

function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function updateUsageBadge() {
  var badge = document.getElementById('usageBadge');
  var isPro = localStorage.getItem('cliff_pro') === 'true';
  if (isPro) {
    badge.textContent = 'Pro';
    badge.style.background = 'var(--ocean-teal)';
    badge.style.color = 'white';
  } else {
    var remaining = FREE_LIMIT - state.usageCount;
    badge.textContent = remaining + ' free analyses left';
    if (remaining <= 1) {
      badge.style.background = 'rgba(231,111,81,0.2)';
      badge.style.color = 'var(--sunset-coral)';
    }
  }
}

async function submitEmail() {
  var email = document.getElementById('emailInput').value.trim();
  if (!email || !email.includes('@')) {
    showToast('Please enter a valid email', 'error');
    return;
  }
  try {
    await fetch(API_BASE + '/api/email-capture', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, source: 'cliff-notez' })
    });
  } catch(e) {}
  state.email = email;
  localStorage.setItem('cliff_email', email);
  closeModal('emailModal');
  showToast('Welcome! You have 3 free analyses.', 'success');
}

function showUpgrade() { showModal('upgradeModal'); }

function selectPlan(el) {
  document.querySelectorAll('.pricing-option').forEach(function(p) { p.classList.remove('selected'); });
  el.classList.add('selected');
  state.selectedPlan = el.dataset.plan;
}

function subscribePro() {
  var priceId = STRIPE_PRICES[state.selectedPlan];
  var email = state.email || '';
  var successUrl = encodeURIComponent(window.location.origin + '?upgraded=true');
  var cancelUrl = encodeURIComponent(window.location.origin);
  showToast('Redirecting to checkout...', 'success');
  window.location.href = API_BASE + '/create-checkout?priceId=' + priceId + '&email=' + email + '&success_url=' + successUrl + '&cancel_url=' + cancelUrl;
}

function showModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

function showToast(msg, type) {
  type = type || 'success';
  var toast = document.getElementById('toast');
  document.getElementById('toastIcon').textContent = type === 'success' ? '‚úì' : '!';
  document.getElementById('toastText').textContent = msg;
  toast.className = 'toast ' + type + ' show';
  setTimeout(function() { toast.classList.remove('show'); }, 3000);
}

document.querySelectorAll('.modal-overlay').forEach(function(o) {
  o.addEventListener('click', function(e) { if (e.target === o) o.classList.remove('active'); });
});
</script>
</body>
</html>
