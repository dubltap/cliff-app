<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLIFF NOTEZ - Doctorate-Level Document Analysis</title>
  <meta name="description" content="Evidence-first research and analysis. Multi-source verification, claim-level confidence ratings, and traceable citations.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
:root {
  --sunset-gold: #F4A261;
  --sunset-coral: #E76F51;
  --ocean-deep: #264653;
  --ocean-teal: #2A9D8F;
  --ocean-foam: #A8DADC;
  --sand-light: #FDF8F3;
  --sand-warm: #E9E0D6;
  --sand-medium: #C4B7A6;
  --sand-dark: #4A4238;
  --cliff-amber: #D4A574;
  --cliff-gold: #C9A227;
  --space-xs: 0.382rem;
  --space-sm: 0.618rem;
  --space-md: 1rem;
  --space-lg: 1.618rem;
  --space-xl: 2.618rem;
  --space-2xl: 4.236rem;
  --font-display: 'Outfit', system-ui, sans-serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: var(--font-body);
  background: linear-gradient(135deg, #FDF8F3 0%, #F5EDE4 50%, #EDE4D8 100%);
  color: var(--sand-dark);
  min-height: 100vh;
  line-height: 1.6;
}
.header {
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--ocean-foam);
  padding: var(--space-md) var(--space-lg);
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-md);
}
.logo-section {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}
.logo {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--cliff-amber), var(--cliff-gold));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 1.2rem;
  color: white;
}
.brand-text h1 {
  font-family: var(--font-display);
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--ocean-deep);
}
.brand-text span {
  font-size: 0.75rem;
  color: var(--sand-medium);
}
.header-actions {
  display: flex;
  gap: var(--space-sm);
  align-items: center;
}
.btn {
  font-family: var(--font-body);
  font-weight: 600;
  padding: var(--space-sm) var(--space-lg);
  border-radius: 100px;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.9rem;
}
.btn-primary {
  background: linear-gradient(135deg, var(--sunset-gold), var(--sunset-coral));
  color: white;
}
.btn-primary:hover {
  transform: translateY(-2px);
}
.btn-secondary {
  background: transparent;
  color: var(--ocean-deep);
  border: 1px solid var(--ocean-foam);
}
.usage-badge {
  background: var(--sand-warm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: 100px;
  font-size: 0.75rem;
}
.hero {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--space-2xl) var(--space-lg);
  text-align: center;
}
.hero h2 {
  font-family: var(--font-display);
  font-size: clamp(2rem, 5vw, 3rem);
  font-weight: 700;
  color: var(--ocean-deep);
  margin-bottom: var(--space-md);
}
.hero h2 span {
  background: linear-gradient(135deg, var(--cliff-amber), var(--cliff-gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.hero p {
  font-size: 1.1rem;
  color: var(--sand-dark);
  max-width: 600px;
  margin: 0 auto;
}
.app-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 var(--space-lg) var(--space-2xl);
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: var(--space-xl);
}
@media (max-width: 900px) {
  .app-container { grid-template-columns: 1fr; }
}
.input-panel {
  background: white;
  border-radius: 20px;
  padding: var(--space-lg);
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  border: 1px solid var(--ocean-foam);
  height: fit-content;
}
.panel-title {
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--ocean-deep);
  margin-bottom: var(--space-md);
}
.mode-selector {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}
.mode-btn {
  padding: var(--space-sm);
  border: 1px solid var(--ocean-foam);
  border-radius: 10px;
  background: white;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--sand-dark);
  font-family: var(--font-body);
  transition: all 0.2s;
}
.mode-btn:hover {
  border-color: var(--ocean-teal);
}
.mode-btn.active {
  background: linear-gradient(135deg, var(--ocean-teal), var(--ocean-deep));
  color: white;
  border-color: transparent;
}
.input-area { margin-bottom: var(--space-md); }
.input-area label {
  display: block;
  font-size: 0.85rem;
  font-weight: 500;
  margin-bottom: var(--space-xs);
}
.input-area textarea {
  width: 100%;
  min-height: 120px;
  padding: var(--space-md);
  border: 1px solid var(--ocean-foam);
  border-radius: 12px;
  font-family: var(--font-body);
  font-size: 0.95rem;
  resize: vertical;
}
.input-area textarea:focus {
  outline: none;
  border-color: var(--ocean-teal);
}
.analyze-btn {
  width: 100%;
  padding: var(--space-md);
  font-size: 1rem;
  background: linear-gradient(135deg, var(--cliff-amber), var(--cliff-gold));
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  font-family: var(--font-body);
  transition: all 0.2s;
}
.analyze-btn:hover {
  transform: translateY(-2px);
}
.analyze-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}
.output-panel {
  background: white;
  border-radius: 20px;
  padding: var(--space-lg);
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  border: 1px solid var(--ocean-foam);
}
.result-card {
  background: var(--sand-light);
  border: 1px solid var(--ocean-foam);
  border-radius: 12px;
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}
.result-card h4 {
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
  font-family: var(--font-display);
}
.result-card ul {
  margin-left: var(--space-lg);
}
.result-card li {
  margin-bottom: var(--space-xs);
}
.placeholder-state {
  text-align: center;
  padding: var(--space-2xl);
  color: var(--sand-medium);
}
.placeholder-state .icon {
  font-size: 4rem;
  margin-bottom: var(--space-md);
}
.placeholder-state h3 {
  font-family: var(--font-display);
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(38,70,83,0.5);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}
.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}
.modal {
  background: white;
  border-radius: 20px;
  padding: var(--space-xl);
  max-width: 440px;
  width: 90%;
  position: relative;
}
.modal-close {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--sand-medium);
}
.modal-icon {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, var(--cliff-amber), var(--cliff-gold));
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  margin: 0 auto var(--space-md);
}
.modal h2 {
  font-family: var(--font-display);
  text-align: center;
  color: var(--ocean-deep);
  margin-bottom: var(--space-sm);
}
.modal p {
  text-align: center;
  margin-bottom: var(--space-lg);
}
.modal input[type="email"] {
  width: 100%;
  padding: var(--space-md);
  border: 1px solid var(--ocean-foam);
  border-radius: 10px;
  font-size: 1rem;
  margin-bottom: var(--space-md);
}
.modal-btn {
  width: 100%;
  padding: var(--space-md);
  background: linear-gradient(135deg, var(--cliff-amber), var(--cliff-gold));
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
}
.modal-terms {
  text-align: center;
  font-size: 0.75rem;
  color: var(--sand-medium);
  margin-top: var(--space-md);
}
.pricing-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}
.pricing-option {
  border: 2px solid var(--ocean-foam);
  border-radius: 12px;
  padding: var(--space-md);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
}
.pricing-option.selected {
  border-color: var(--cliff-gold);
  background: rgba(201,162,39,0.05);
}
.popular-badge {
  position: absolute;
  top: -10px;
  right: 10px;
  background: var(--sunset-coral);
  color: white;
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 100px;
  font-weight: 600;
}
.pricing-name { font-weight: 600; color: var(--ocean-deep); }
.pricing-detail { font-size: 0.8rem; color: var(--sand-medium); }
.pricing-price strong { font-size: 1.2rem; color: var(--ocean-deep); }
.pricing-price span { font-size: 0.8rem; color: var(--sand-medium); }
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--ocean-deep);
  color: white;
  padding: var(--space-md) var(--space-lg);
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 1001;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: var(--ocean-teal); }
.toast.error { background: var(--sunset-coral); }
.footer {
  text-align: center;
  padding: var(--space-xl);
  color: var(--sand-medium);
  font-size: 0.85rem;
}
.footer a { color: var(--ocean-teal); text-decoration: none; }
.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">CN</div>
        <div class="brand-text">
          <h1>CLIFF NOTEZ</h1>
          <span>Evidence-first research & analysis</span>
        </div>
      </div>
      <div class="header-actions">
        <span class="usage-badge" id="usageBadge">3 free analyses left</span>
        <button class="btn btn-primary" onclick="showUpgrade()">Upgrade Pro</button>
      </div>
    </div>
  </header>

  <section class="hero">
    <h2>Turn Documents Into <span>Actionable Insights</span></h2>
    <p>Doctorate-level analysis with multi-source verification and traceable citations.</p>
  </section>

  <main class="app-container">
    <aside class="input-panel">
      <div class="panel-title">Analysis Mode</div>
      <div class="mode-selector">
        <button class="mode-btn active" data-mode="doctoral" onclick="setMode(this)">Doctoral Report</button>
        <button class="mode-btn" data-mode="cliff" onclick="setMode(this)">Cliff Notes</button>
        <button class="mode-btn" data-mode="exegesis" onclick="setMode(this)">Exegesis</button>
        <button class="mode-btn" data-mode="tutor" onclick="setMode(this)">Tutor Mode</button>
        <button class="mode-btn" data-mode="critic" onclick="setMode(this)">Critic Mode</button>
        <button class="mode-btn" data-mode="learning" onclick="setMode(this)">Learning Track</button>
      </div>

      <div class="input-area">
        <label>Paste your document or question</label>
        <textarea id="promptInput" placeholder="Paste document text here, or type a question like: What is the summary of quantum computing?"></textarea>
      </div>

      <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
        Analyze Document
      </button>
    </aside>

    <section class="output-panel">
      <div id="outputContent">
        <div class="placeholder-state">
          <div class="icon">ðŸ“š</div>
          <h3>Ready to Analyze</h3>
          <p>Paste document text or enter a question to get started.</p>
        </div>
      </div>
    </section>
  </main>

  <div class="modal-overlay" id="emailModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('emailModal')">x</button>
      <div class="modal-icon">ðŸ“š</div>
      <h2>Unlock CLIFF NOTEZ</h2>
      <p>Get 3 free doctorate-level analyses. No credit card required.</p>
      <input type="email" id="emailInput" placeholder="your@email.com">
      <button class="modal-btn" onclick="submitEmail()">Get Free Access</button>
      <p class="modal-terms">No spam. Unsubscribe anytime.</p>
    </div>
  </div>

  <div class="modal-overlay" id="upgradeModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('upgradeModal')">x</button>
      <div class="modal-icon">ðŸŽ“</div>
      <h2>Upgrade to Pro</h2>
      <p>Unlimited analyses, all modes, priority processing.</p>
      <div class="pricing-options">
        <div class="pricing-option popular selected" data-plan="annual" onclick="selectPlan(this)">
          <span class="popular-badge">Best Value</span>
          <div>
            <div class="pricing-name">Annual</div>
            <div class="pricing-detail">Save 35%</div>
          </div>
          <div class="pricing-price">
            <strong>$149</strong>
            <span>/year</span>
          </div>
        </div>
        <div class="pricing-option" data-plan="monthly" onclick="selectPlan(this)">
          <div>
            <div class="pricing-name">Monthly</div>
            <div class="pricing-detail">Cancel anytime</div>
          </div>
          <div class="pricing-price">
            <strong>$19</strong>
            <span>/mo</span>
          </div>
        </div>
      </div>
      <button class="modal-btn" onclick="subscribePro()">Start Pro Access</button>
      <p class="modal-terms">30-day money-back guarantee</p>
    </div>
  </div>

  <div class="toast" id="toast">
    <span id="toastIcon">âœ“</span>
    <span id="toastText">Success!</span>
  </div>

  <footer class="footer">
    <p>CLIFF NOTEZ by <a href="https://dubltap.io">dubltap.io</a></p>
  </footer>

<script>
const API_BASE = 'https://api.dubltap.io';
const STRIPE_PRICES = {
  monthly: 'price_1SviddBkYqg7J4R7wwwCGKId',
  annual: 'price_1SviefBkYqg7J4R7y6KW4pXQ'
};
const FREE_LIMIT = 3;

const state = {
  email: localStorage.getItem('cliff_email') || null,
  usageCount: parseInt(localStorage.getItem('cliff_usage') || '0'),
  mode: 'doctoral',
  selectedPlan: 'annual'
};

document.addEventListener('DOMContentLoaded', function() {
  updateUsageBadge();
  const params = new URLSearchParams(window.location.search);
  if (params.get('upgraded') === 'true') {
    showToast('Welcome to Pro! Unlimited analyses unlocked.', 'success');
    localStorage.setItem('cliff_pro', 'true');
    window.history.replaceState({}, '', window.location.pathname);
  }
  if (!state.email) {
    setTimeout(function() { showModal('emailModal'); }, 1500);
  }
});

function setMode(btn) {
  document.querySelectorAll('.mode-btn').forEach(function(b) { b.classList.remove('active'); });
  btn.classList.add('active');
  state.mode = btn.dataset.mode;
}

async function runAnalysis() {
  const content = document.getElementById('promptInput').value.trim();
  
  if (!content) {
    showToast('Please enter text to analyze', 'error');
    return;
  }
  
  if (!state.email) {
    showModal('emailModal');
    return;
  }
  
  const isPro = localStorage.getItem('cliff_pro') === 'true';
  if (!isPro && state.usageCount >= FREE_LIMIT) {
    showUpgrade();
    return;
  }

  const btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="loading-spinner"></span> Analyzing...';

  try {
    const response = await fetch(API_BASE + '/api/ai-query', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        app: 'cliff-notez',
        action: 'analyze-document',
        content: content,
        analysisType: state.mode,
        email: state.email
      })
    });
    
    const data = await response.json();
    
    if (data.error) {
      showToast(data.error, 'error');
      return;
    }
    
    if (!isPro) {
      state.usageCount++;
      localStorage.setItem('cliff_usage', state.usageCount.toString());
      updateUsageBadge();
    }
    
    // Parse the result
    let result;
    try {
      result = typeof data.result === 'string' ? JSON.parse(data.result) : data.result;
    } catch(e) {
      result = { summary: data.result };
    }
    
    renderResults(result);
    
  } catch (error) {
    console.error('Analysis error:', error);
    showToast('Analysis failed - please try again', 'error');
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'Analyze Document';
  }
}

function renderResults(data) {
  const output = document.getElementById('outputContent');
  let html = '';
  
  if (data.title) {
    html += '<h3 style="font-family: var(--font-display); color: var(--ocean-deep); margin-bottom: var(--space-md);">' + esc(data.title) + '</h3>';
  }
  
  if (data.summary) {
    html += '<div class="result-card"><h4>Summary</h4><p>' + esc(data.summary) + '</p></div>';
  }
  
  if (data.keyPoints && data.keyPoints.length) {
    html += '<div class="result-card"><h4>Key Points</h4><ul>';
    data.keyPoints.forEach(function(p) { html += '<li>' + esc(p) + '</li>'; });
    html += '</ul></div>';
  }
  
  if (data.themes && data.themes.length) {
    html += '<div class="result-card"><h4>Themes</h4><ul>';
    data.themes.forEach(function(t) { html += '<li>' + esc(t) + '</li>'; });
    html += '</ul></div>';
  }
  
  if (data.insights && data.insights.length) {
    html += '<div class="result-card"><h4>Insights</h4><ul>';
    data.insights.forEach(function(i) { 
      var txt = typeof i === 'object' ? i.insight : i;
      html += '<li>' + esc(txt) + '</li>'; 
    });
    html += '</ul></div>';
  }
  
  if (data.questions && data.questions.length) {
    html += '<div class="result-card"><h4>Questions Raised</h4><ul>';
    data.questions.forEach(function(q) { html += '<li>' + esc(q) + '</li>'; });
    html += '</ul></div>';
  }
  
  if (data.actionItems && data.actionItems.length) {
    html += '<div class="result-card"><h4>Action Items</h4><ul>';
    data.actionItems.forEach(function(a) { html += '<li>' + esc(a) + '</li>'; });
    html += '</ul></div>';
  }
  
  if (!html) {
    html = '<div class="result-card"><p>' + esc(JSON.stringify(data)) + '</p></div>';
  }
  
  output.innerHTML = html;
}

function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function updateUsageBadge() {
  const badge = document.getElementById('usageBadge');
  const isPro = localStorage.getItem('cliff_pro') === 'true';
  if (isPro) {
    badge.textContent = 'Pro';
    badge.style.background = 'var(--ocean-teal)';
    badge.style.color = 'white';
  } else {
    const remaining = FREE_LIMIT - state.usageCount;
    badge.textContent = remaining + ' free analyses left';
    if (remaining <= 1) {
      badge.style.background = 'rgba(231,111,81,0.2)';
      badge.style.color = 'var(--sunset-coral)';
    }
  }
}

async function submitEmail() {
  const email = document.getElementById('emailInput').value.trim();
  if (!email || !email.includes('@')) {
    showToast('Please enter a valid email', 'error');
    return;
  }
  try {
    await fetch(API_BASE + '/api/email-capture', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email, source: 'cliff-notez' })
    });
  } catch(e) {}
  state.email = email;
  localStorage.setItem('cliff_email', email);
  closeModal('emailModal');
  showToast('Welcome! You have 3 free analyses.', 'success');
}

function showUpgrade() { showModal('upgradeModal'); }

function selectPlan(el) {
  document.querySelectorAll('.pricing-option').forEach(function(p) { p.classList.remove('selected'); });
  el.classList.add('selected');
  state.selectedPlan = el.dataset.plan;
}

function subscribePro() {
  const priceId = STRIPE_PRICES[state.selectedPlan];
  const email = state.email || '';
  const successUrl = encodeURIComponent(window.location.origin + '?upgraded=true');
  const cancelUrl = encodeURIComponent(window.location.origin);
  showToast('Redirecting to checkout...', 'success');
  window.location.href = 'https://api.dubltap.io/create-checkout?priceId=' + priceId + '&email=' + email + '&success_url=' + successUrl + '&cancel_url=' + cancelUrl;
}

function showModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

function showToast(msg, type) {
  type = type || 'success';
  var toast = document.getElementById('toast');
  document.getElementById('toastIcon').textContent = type === 'success' ? 'âœ“' : '!';
  document.getElementById('toastText').textContent = msg;
  toast.className = 'toast ' + type + ' show';
  setTimeout(function() { toast.classList.remove('show'); }, 3000);
}

document.querySelectorAll('.modal-overlay').forEach(function(o) {
  o.addEventListener('click', function(e) {
    if (e.target === o) o.classList.remove('active');
  });
});
</script>
</body>
</html>
